# GTS Architecture with Supabase Integration

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          GTS MOBILE APP                               â”‚
â”‚                         (React + TypeScript)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ROUTING LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Driver    â”‚  â”‚  Official   â”‚  â”‚    Admin     â”‚  â”‚  Landing   â”‚ â”‚
â”‚  â”‚   Routes    â”‚  â”‚   Routes    â”‚  â”‚   Routes     â”‚  â”‚    Page    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTHENTICATION LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  auth.ts - Unified Authentication Interface                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ signUp()      â”œâ”€ signIn()       â”œâ”€ signOut()               â”‚ â”‚
â”‚  â”‚  â”œâ”€ getSession()  â”œâ”€ getCurrentUser()                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â”‚                         â”‚                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â–¼                      â–¼   â–¼                   â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Supabase   â”‚   OR   â”‚   Client    â”‚   OR   â”‚ localStorageâ”‚     â”‚
â”‚  â”‚    Auth     â”‚        â”‚    Auth     â”‚        â”‚   Fallback  â”‚     â”‚
â”‚  â”‚  (Online)   â”‚        â”‚ (Offline)   â”‚        â”‚             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATA SYNC LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  sync-service.ts - Smart Sync Layer                              â”‚ â”‚
â”‚  â”‚  â”œâ”€ syncUser()         â”œâ”€ getAllUsers()                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ syncParcel()       â”œâ”€ getAllParcels()                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ syncQRCode()       â”œâ”€ getParcelByReference()                â”‚ â”‚
â”‚  â”‚  â”œâ”€ syncDocument()     â”œâ”€ updateParcelStatus()                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ syncAll()          â”œâ”€ pullFromSupabase()                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â”‚                         â”‚                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â–¼                      â–¼   â–¼                   â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ localStorageâ”‚ â—„â”€syncâ”€â–ºâ”‚ supabase-db â”‚â—„â”€syncâ”€â–ºâ”‚  Supabase   â”‚     â”‚
â”‚  â”‚   (Cache)   â”‚        â”‚    .ts      â”‚        â”‚  Database   â”‚     â”‚
â”‚  â”‚  ALWAYS ON  â”‚        â”‚ (Adapter)   â”‚        â”‚  (Cloud)    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       BUSINESS LOGIC LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  parcels.ts â”‚  â”‚documents.ts â”‚  â”‚  hs-codes.ts â”‚  â”‚  utils.ts  â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚              â”‚  â”‚            â”‚ â”‚
â”‚  â”‚ â€¢ Create    â”‚  â”‚ â€¢ Bill of   â”‚  â”‚ â€¢ Auto-gen   â”‚  â”‚ â€¢ Helpers  â”‚ â”‚
â”‚  â”‚ â€¢ Track     â”‚  â”‚   Lading    â”‚  â”‚   HS Codes   â”‚  â”‚ â€¢ Format   â”‚ â”‚
â”‚  â”‚ â€¢ Update    â”‚  â”‚ â€¢ Road      â”‚  â”‚ â€¢ Categories â”‚  â”‚ â€¢ Validate â”‚ â”‚
â”‚  â”‚             â”‚  â”‚   Manifest  â”‚  â”‚              â”‚  â”‚            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         UI COMPONENTS                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Driver Components                                                â”‚ â”‚
â”‚  â”‚ â€¢ DriverSignUp  â€¢ DriverLogin  â€¢ DriverHome                      â”‚ â”‚
â”‚  â”‚ â€¢ DriverItemDetails  â€¢ DriverSenderDetails                       â”‚ â”‚
â”‚  â”‚ â€¢ DriverReceiverDetails  â€¢ DriverParcelConfirmation             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Official Components                                              â”‚ â”‚
â”‚  â”‚ â€¢ OfficialSignUp  â€¢ OfficialLogin  â€¢ OfficialHome               â”‚ â”‚
â”‚  â”‚ â€¢ QRScanner  â€¢ TrackingSearch  â€¢ TrackingResult                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Admin Components                                                 â”‚ â”‚
â”‚  â”‚ â€¢ AdminLogin  â€¢ AdminDashboard  â€¢ AdminDrivers                  â”‚ â”‚
â”‚  â”‚ â€¢ AdminOfficials  â€¢ AdminItems  â€¢ SupabaseStatus               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagrams

### 1. User Registration Flow

```
Driver Opens App
       â”‚
       â–¼
Fill Registration Form
(Name, Phone, Vehicle Info, Photos)
       â”‚
       â–¼
Click "Register" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                           â”‚
       â–¼                           â–¼
Save to localStorage         auth.signUp()
(Instant, Always Works)            â”‚
       â”‚                           â”œâ”€â”€â–º Supabase Auth
       â”‚                           â”‚    (if configured)
       â”‚                           â”‚
       â”‚                           â”œâ”€â”€â–º Client Auth
       â”‚                           â”‚    (if offline/fallback)
       â”‚                           â”‚
       â–¼                           â–¼
UI Shows Success          Generate User ID
       â”‚                           â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
syncUser() [Background]
       â”‚
       â”œâ”€â”€â–º Save to localStorage (gts_users)
       â”‚
       â””â”€â”€â–º Sync to Supabase users table
            (if configured, non-blocking)
```

### 2. Parcel Creation Flow

```
Driver Creates Parcel
       â”‚
       â–¼
Multi-Step Form
â€¢ Item Details (with camera)
â€¢ Sender Info
â€¢ Receiver Info
       â”‚
       â–¼
Generate Documents
â€¢ Bill of Lading (PDF)
â€¢ Road Manifest (PDF)
       â”‚
       â–¼
Generate QR Code
(Contains encrypted documents)
       â”‚
       â–¼
Save to localStorage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
(gts_parcels)                      â”‚
       â”‚                           â”‚
       â–¼                           â–¼
Show Success Screen          syncParcel() [Background]
(with QR Code)                     â”‚
       â”‚                           â”œâ”€â”€â–º Supabase parcels table
       â”‚                           â”‚
       â”‚                           â”œâ”€â”€â–º Supabase qr_codes table
       â”‚                           â”‚
       â”‚                           â””â”€â”€â–º Supabase documents table
       â”‚                                (if configured)
       â”‚
       â–¼
Driver can print/share QR Code
```

### 3. QR Code Scanning Flow

```
Official Opens Scanner
       â”‚
       â–¼
Scan QR Code
       â”‚
       â–¼
Decrypt QR Data
       â”‚
       â–¼
Extract Reference Number
       â”‚
       â–¼
Search for Parcel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                          â”‚
       â”‚                          â”œâ”€â”€â–º Try Supabase
       â”‚                          â”‚    getParcelByReference()
       â”‚                          â”‚
       â”‚                          â””â”€â”€â–º Fallback to localStorage
       â”‚                               (gts_parcels)
       â–¼
Display Parcel Details
â€¢ Sender Info
â€¢ Receiver Info
â€¢ Items List
â€¢ Documents (Bill of Lading, Manifest)
       â”‚
       â–¼
Official Verifies â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                          â”‚
       â–¼                          â–¼
Update Status              updateParcelStatus()
       â”‚                          â”‚
       â”‚                          â”œâ”€â”€â–º Update localStorage
       â”‚                          â”‚
       â”‚                          â””â”€â”€â–º Sync to Supabase
       â”‚                               (if configured)
       â–¼
Show Success Message
```

### 4. Admin Dashboard Flow

```
Admin Opens Dashboard
       â”‚
       â–¼
Load Statistics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                           â”‚
       â”‚                           â”œâ”€â”€â–º Try getStatsFromSupabase()
       â”‚                           â”‚    â€¢ Count users by role
       â”‚                           â”‚    â€¢ Count parcels
       â”‚                           â”‚    â€¢ Count documents
       â”‚                           â”‚
       â”‚                           â””â”€â”€â–º Fallback to localStorage
       â”‚                                â€¢ Parse gts_users
       â”‚                                â€¢ Parse gts_parcels
       â–¼
Display Dashboard
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Statistics                   â”‚
â”‚ â€¢ 5 Drivers                     â”‚
â”‚ â€¢ 3 Officials                   â”‚
â”‚ â€¢ 12 Parcels                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”„ Supabase Status              â”‚
â”‚ â€¢ Connected / Local Only        â”‚
â”‚ â€¢ Last sync: 2 min ago          â”‚
â”‚ â€¢ [Push] [Pull] buttons         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ Tabs                         â”‚
â”‚ â€¢ Drivers List                  â”‚
â”‚ â€¢ Officials List                â”‚
â”‚ â€¢ Parcels List                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Admin Actions
â€¢ View Details
â€¢ Manual Sync
â€¢ Export Data
```

---

## Sync Mechanisms

### Auto-Sync (Every 30 seconds)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auto-Sync Timer (30s interval)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          Check Supabase Configured?
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                 â”‚
           YES               NO
            â”‚                 â”‚
            â–¼                 â–¼
      Try syncAll()      Skip (log message)
            â”‚
            â”œâ”€â”€â–º Read localStorage
            â”‚    â€¢ gts_users
            â”‚    â€¢ gts_parcels
            â”‚
            â–¼
      For Each Record:
      â”œâ”€ Check if exists in Supabase
      â”‚  (by ID or reference number)
      â”‚
      â”œâ”€ If NOT exists: Insert
      â”‚
      â””â”€ If exists: Update (if local is newer)
            â”‚
            â–¼
      Log Results
      â€¢ Success: "Synced X records"
      â€¢ Failure: "Sync failed, will retry"
            â”‚
            â–¼
      Call onSyncComplete() or onSyncError()
```

### Manual Sync

```
Admin Clicks "Push Local"
       â”‚
       â–¼
syncAll() Triggered
       â”‚
       â”œâ”€â”€â–º Users: Push all gts_users to Supabase
       â”‚
       â”œâ”€â”€â–º Parcels: Push all gts_parcels to Supabase
       â”‚
       â””â”€â”€â–º Show toast: "Sync complete!"


Admin Clicks "Pull Cloud"
       â”‚
       â–¼
pullFromSupabase() Triggered
       â”‚
       â”œâ”€â”€â–º Users: Fetch all from Supabase
       â”‚    â””â”€â”€â–º Update localStorage (gts_users)
       â”‚
       â”œâ”€â”€â–º Parcels: Fetch all from Supabase
       â”‚    â””â”€â”€â–º Update localStorage (gts_parcels)
       â”‚
       â””â”€â”€â–º Show toast: "Data refreshed!"
```

---

## Database Schema Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase PostgreSQL Database                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚   users    â”‚                                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                     â”‚
â”‚  â”‚ id (PK)    â”‚â—„â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ phone      â”‚     â”‚                              â”‚
â”‚  â”‚ full_name  â”‚     â”‚                              â”‚
â”‚  â”‚ role       â”‚     â”‚ driver_id (FK)               â”‚
â”‚  â”‚ ...        â”‚     â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                              â”‚
â”‚                     â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                              â”‚
â”‚  â”‚  parcels   â”‚     â”‚                              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚                              â”‚
â”‚  â”‚ id (PK)    â”‚â”€â”€â”€â”€â–ºâ”‚                              â”‚
â”‚  â”‚ ref_number â”‚â—„â”€â”€â”€â”€â”¼â”€â”€â”                           â”‚
â”‚  â”‚ driver_id  â”‚     â”‚  â”‚                           â”‚
â”‚  â”‚ items      â”‚     â”‚  â”‚ reference_number (FK)     â”‚
â”‚  â”‚ documents  â”‚     â”‚  â”‚                           â”‚
â”‚  â”‚ ...        â”‚     â”‚  â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚                           â”‚
â”‚        â”‚            â”‚  â”‚                           â”‚
â”‚        â”‚ parcel_id  â”‚  â”‚                           â”‚
â”‚        â”‚ (FK)       â”‚  â”‚                           â”‚
â”‚        â”‚            â”‚  â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚                           â”‚
â”‚  â”‚  qr_codes  â”‚     â”‚  â”‚                           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚  â”‚                           â”‚
â”‚  â”‚ id (PK)    â”‚â”€â”€â”€â”€â”€â”˜  â”‚                           â”‚
â”‚  â”‚ parcel_id  â”‚        â”‚                           â”‚
â”‚  â”‚ ref_number â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚  â”‚ qr_data    â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚        â”‚                                           â”‚
â”‚        â”‚ parcel_id (FK)                            â”‚
â”‚        â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ documents  â”‚                                    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                    â”‚
â”‚  â”‚ id (PK)    â”‚â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚  â”‚ parcel_id  â”‚                                    â”‚
â”‚  â”‚ doc_type   â”‚                                    â”‚
â”‚  â”‚ file_data  â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Row Level Security (RLS) Policies                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  users table:                                       â”‚
â”‚  â”œâ”€ SELECT: Anyone (public read)                   â”‚
â”‚  â”œâ”€ INSERT: auth.uid() = id (own profile)          â”‚
â”‚  â””â”€ UPDATE: auth.uid() = id (own profile)          â”‚
â”‚                                                     â”‚
â”‚  parcels table:                                     â”‚
â”‚  â”œâ”€ SELECT: Anyone (for tracking)                  â”‚
â”‚  â”œâ”€ INSERT: Authenticated users                    â”‚
â”‚  â””â”€ UPDATE: auth.uid() = driver_id (own parcels)   â”‚
â”‚                                                     â”‚
â”‚  qr_codes table:                                    â”‚
â”‚  â”œâ”€ SELECT: Anyone (for scanning)                  â”‚
â”‚  â””â”€ INSERT: Authenticated users                    â”‚
â”‚                                                     â”‚
â”‚  documents table:                                   â”‚
â”‚  â”œâ”€ SELECT: Anyone (for viewing)                   â”‚
â”‚  â””â”€ INSERT: Authenticated users                    â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Offline/Online Behavior

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OFFLINE MODE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. All operations use localStorage                     â”‚
â”‚  2. Data saved instantly (no waiting)                   â”‚
â”‚  3. App fully functional                                â”‚
â”‚  4. Sync marked as "pending"                            â”‚
â”‚  5. UI shows "offline" indicator                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Connection restored
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ONLINE MODE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Auto-sync kicks in (30s interval)                   â”‚
â”‚  2. Pending changes pushed to Supabase                  â”‚
â”‚  3. Latest data pulled from Supabase                    â”‚
â”‚  4. localStorage updated with cloud data                â”‚
â”‚  5. UI shows "connected" indicator                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Structure

```
/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ supabase.ts         (Supabase client config)
â”‚   â”‚   â”œâ”€â”€ supabase-db.ts      (Direct DB operations)
â”‚   â”‚   â”œâ”€â”€ sync-service.ts     (Smart sync layer) â­
â”‚   â”‚   â”œâ”€â”€ auth.ts             (Authentication)
â”‚   â”‚   â”œâ”€â”€ client-auth.ts      (Offline auth fallback)
â”‚   â”‚   â”œâ”€â”€ parcels.ts          (Parcel business logic)
â”‚   â”‚   â””â”€â”€ documents.ts        (Document generation)
â”‚   â”‚
â”‚   â””â”€â”€ app/
â”‚       â””â”€â”€ components/
â”‚           â”œâ”€â”€ driver/         (Driver UI components)
â”‚           â”œâ”€â”€ official/       (Official UI components)
â”‚           â”œâ”€â”€ admin/
â”‚           â”‚   â”œâ”€â”€ AdminDashboard.tsx
â”‚           â”‚   â”œâ”€â”€ AdminDrivers.tsx
â”‚           â”‚   â”œâ”€â”€ AdminOfficials.tsx
â”‚           â”‚   â”œâ”€â”€ AdminItems.tsx
â”‚           â”‚   â””â”€â”€ SupabaseStatus.tsx â­
â”‚           â””â”€â”€ ui/             (Reusable UI components)
â”‚
â”œâ”€â”€ supabase-schema.sql         (Database schema) â­
â”œâ”€â”€ SUPABASE_SETUP_GUIDE.md     (Setup instructions) â­
â”œâ”€â”€ INTEGRATION_EXAMPLES.md     (Code examples) â­
â”œâ”€â”€ SUPABASE_SUMMARY.md         (Quick reference) â­
â””â”€â”€ ARCHITECTURE_DIAGRAM.md     (This file) â­

â­ = New files for Supabase integration
```

---

## Key Design Decisions

### 1. **Offline-First**
- localStorage is the source of truth
- Supabase is a sync target, not the primary storage
- App never depends on network connectivity

### 2. **Non-Blocking Sync**
- Sync operations never freeze the UI
- Failures are logged but don't block user actions
- Auto-retry mechanism for failed syncs

### 3. **Gradual Enhancement**
- App works without Supabase (localStorage only)
- Adding Supabase enhances but doesn't replace
- Existing code continues to work unchanged

### 4. **Type Safety**
- Full TypeScript types for all operations
- Database types match localStorage structures
- Compile-time checking for data integrity

### 5. **Security by Default**
- RLS enabled on all tables
- Public read for tracking/verification
- Private write for data integrity

---

This architecture provides:
âœ… Offline capability
âœ… Cloud backup
âœ… Multi-device sync
âœ… Real-time updates
âœ… Scalability
âœ… Security
âœ… Type safety
